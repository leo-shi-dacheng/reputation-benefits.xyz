import{r as o,h as V,a as t,j as e,p as $,i as Y,k as q,l as X,m as K,W as Q,C as Z,I as ee,S as te,L as I,A as ae,n as se,o as ne}from"./.pnpm-3ed82fb7.js";import{g as re,t as N,b as D,u as E,s as oe,f as ie,a as ce,o as L,S as j}from"./index-d49b3526.js";const le=({onProgressChange:n})=>{const[a,l]=o.useState(0),[u,s]=o.useState(0),m=[0,25,50,75,100],[,i]=V({type:"PROGRESS",item:{progress:a}}),h=c=>{const b=m[c];l(b),s(c),n(b)};return t("div",{className:"progress-container",children:[e("div",{className:"progress-bar",style:{width:`${a}%`,borderRadius:"20px"}}),e("div",{className:"progress-blocks",children:m.map((c,b)=>e("div",{className:`progress-block ${u===b?"selected":""}`,onClick:()=>h(b)},b))}),e("div",{className:"draggable-circle",ref:i})]})},de=n=>{const[a,l]=o.useState(0);return t("div",{className:"process-container",children:[t("div",{className:"text-center font-bold leading-8",children:["Additional BRP withdraw",t("span",{className:"text-green",children:[" ",a,"%"]})]}),e(le,{onProgressChange:s=>{l(s),n?.onProgressChange(s)}})]})};const A=async(n,a)=>{const l=re(n),u={method:"GET",body:null,headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")?"Bearer "+localStorage.getItem("token"):""},credentials:"include",cache:"no-cache",mode:"cors",responseType:"JSON"},s={...u,...a};a&&a.headers&&(s.headers={...u.headers,Authorization:localStorage.getItem("token")?"Bearer "+localStorage.getItem("token"):"",...a.headers}),s.body&&/^(POST|PUT|PATCH)$/i.test(s.method?.toUpperCase()||"")&&s.responseType&&s.responseType.toUpperCase()==="JSON"&&(s.body=JSON.stringify({...s.body}));const m={method:s.method?.toUpperCase(),credentials:s.credentials,mode:s.mode,cache:s.cache,headers:s.headers,body:s.body};return fetch(`${l}`,m).then(i=>{const{status:h}=i;if(h>=200&&h<400){let c;switch(s.responseType&&s.responseType.toUpperCase()){case"TEXT":c=i.text();break;case"JSON":c=i.json();break;case"BLOB":c=i.blob();break;case"ARRAYBUFFER":c=i.arrayBuffer();break;default:c=i.json()}return c}return Promise.reject(i)}).catch(i=>{if(typeof window<"u"&&navigator&&!navigator.onLine&&N.error("Your network is break!",{id:"statusnetwork"}),i&&i.status)switch(i.status){case 400:N.error("Please verify your info!",{id:"status400"});break;case 403:N.error("You have no access to this",{id:"status403"});break;case 500:N.error("Oops, there's something wrong!",{id:"status500"});break;case 504:N.error("Oops, there's something wrong!",{id:"status504"});break}else N.error("Oops, there's something wrong!",{id:"status500"});return Promise.reject(i)})},ue=async(n={})=>{const a=D("/api/v1/getMintList",n);return await A(a)},pe=async(n={})=>{const a=D("/api/v1/getMintTotal",n);return await A(a)},me=async()=>await A("/api/v1/getSnapshotTime"),he=async(n={})=>{const a=D("/api/v1/getTreasuryFunds",n);return await A(a)};class ye{tree=null;constructor(a){this.initMerkleTree(a).then(()=>{console.log("MerkleTree initialized.")})}async initMerkleTree(a){const l=await Promise.all(a.map(u=>this.keccak256Hash($(["address","uint256"],[u[0],u[1]]))));this.tree=new Y.MerkleTree(l,this.keccak256Hash,{sortPairs:!0})}async keccak256Hash(a){const u=new TextEncoder().encode(a),s=await window.crypto.subtle.digest("SHA-256",u),m=Array.from(new Uint8Array(s));return q(m)}async getRoot(){if(!this.tree)throw new Error("MerkleTree is not initialized yet.");return this.tree.getHexRoot()}async getProof(a,l){if(!this.tree)throw new Error("MerkleTree is not initialized yet.");const u=await this.keccak256Hash($(["address","uint256"],[a,l]));return this.tree.getHexProof(u)}}const fe=[{inputs:[{internalType:"address",name:"_token",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"address",name:"token",type:"address"}],name:"Claimed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"address",name:"oldToken",type:"address"},{indexed:!1,internalType:"address",name:"newToken",type:"address"}],name:"RewardTokenChanged",type:"event"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bytes32[]",name:"proof",type:"bytes32[]"},{internalType:"uint256",name:"ratio",type:"uint256"}],name:"claim",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"claimed",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"epoch",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"merkleRoot",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"pBRP",outputs:[{internalType:"contract PBRP",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"reclaim",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"_merkleRoot",type:"bytes32"}],name:"setMerkleRoot",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"token",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token_",type:"address"}],name:"updateToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"account",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bytes32[]",name:"proof",type:"bytes32[]"}],name:"verify",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],ge=()=>{const{auth:n,setAuth:a,setClaim:l,claim:u}=E(),[s,m]=o.useState(0),[i,h]=o.useState(0),[c,b]=o.useState(0),[B,S]=o.useState(0),k=async p=>{try{const{code:d,message:f,data:g}=await he(p);if(d==0){const{user_brp:P,total_treasury_usdt:W,total_treasury_brp:F,total_treasury_grant:J}=g;h(P),m(F),b(J),S(W)}else console.log(f)}catch(d){console.error(d)}},[_,M]=o.useState(""),[v,R]=o.useState(""),r=async()=>{try{const{code:p,message:d,data:f}=await me();if(p==0){const{snapshot_time:g,current_period:P}=f;await M(P),await R(g),localStorage.setItem("current_period",P),k({address:n.address,month:P})}else console.log(d)}catch(p){console.error(p)}};o.useEffect(()=>{r()},[]);const[y,w]=o.useState(1032),[T,x]=o.useState(0),[C,U]=o.useState(0),z=p=>{U(p)},O=()=>{const d=new Q(window.ethereum).getSigner(),f="0xc5E34005f3C9a26bf7C82a6516a02C49D3D9D646";return new Z(f,fe,d)},H=async(p,d)=>{const f=[],g=await new ye(f);return await g.getRoot(),g.getProof(p,d)},G=async(p,d,f)=>{try{return await O().verify(p,d,f)}catch(g){return console.error("Error verifying user eligibility:",g),!1}};return t("div",{className:"box-container",children:[e("div",{className:"box-title font-bold",children:"Reputation Benefits"}),t("div",{className:"date flex justify-between",children:[t("div",{children:[e("span",{className:"mr-[8px]",children:"Current period:"}),t("span",{className:"date-value",children:[" ",_," "]})]}),t("div",{children:[e("span",{className:"mr-[8px]",children:"Snapshot: "}),e("span",{className:"date-value",children:v})]})]}),t("div",{className:"infomation text-green size-[16px] text-center columns-2 mt-[40px]",children:[t("div",{className:"infomation-item mb-[40px]",children:[t("div",{className:"infomation-label",children:[e("p",{children:"Community-Generated"}),e("p",{children:"Reputation"})]}),t("div",{className:"infomation-value",children:[s," BRP"]})]}),t("div",{className:"infomation-item mb-[40px]",children:[e("div",{className:"infomation-label",children:"Treasury"}),t("div",{className:"infomation-value",children:[c," USD"]})]}),t("div",{className:"infomation-item mb-[40px]",children:[t("div",{className:"infomation-label",children:[e("p",{children:"My Additional"}),e("p",{children:"Reputation"})]}),t("div",{className:"infomation-value",children:[i," BRP"]})]}),t("div",{className:"infomation-item mb-[40px]",children:[e("div",{className:"infomation-label",children:"Treasury Airdrop"}),t("div",{className:"infomation-value",children:[B," USD"]})]})]}),e(de,{onProgressChange:z}),t("div",{className:"mint-count size-[16px] text-center columns-2 mt-[40px] flex justify-around",children:[t("div",{className:"mint-count-item",children:[e("div",{className:"mint-count-label",children:"pBRP Minting"}),e("div",{className:"mint-count-value",children:y})]}),t("div",{className:"mint-count-item",children:[e("div",{className:"mint-count-label",children:"Withdrawable USDT"}),e("div",{className:"mint-count-value",children:T})]})]}),e(X,{className:`claim-btn ${C?"active-btn":""}`,disabled:!C,onClick:async()=>{console.log("claim");const p=O(),d=K(y.toString(),18);console.log(d,"amount");const f=await H(n.address,d);console.log(f,"userProof"),await G(n.address,d,f);try{await(await p.claim(n.address,d,f,C)).wait(),console.log("Claim successful!"),N.success("Claim successful!")}catch(g){console.error("Claim failed:",g),N.error("Claim failed!")}},children:"Claim Reward"})]})};const be=({isMyself:n,isCurrentPeriod:a})=>{const{auth:l,setClaim:u,claim:s}=E(),[m,i]=o.useState(1),[h,c]=o.useState([]),[b,B]=o.useState(0),[S,k]=o.useState(!1),_=async(r=1)=>{try{let y="";a&&(y=localStorage.getItem("current_period")||"");let w="";n&&(w=l.address);const T={month:y,address:w,page_no:r};console.log(T,"param");const{code:x,message:C,data:U}=await ue(T);return x==0?(B(U.total||0),U.list||[]):(console.log(C),[])}catch(y){return console.error(y),[]}},M=async r=>{try{if(S)return;k(!0);const y=await _(r),w=[];for await(const x of y)x.avater=await ce(x.address),w.push(x);const T=r===1?w:[...h,...w];c(T),k(!1)}catch(y){console.error("加载数据时发生错误：",y),k(!1)}};o.useEffect(()=>{c([]),i(1),l.address&&setTimeout(()=>{M(1)},100)},[n,a,l.address]);const v=()=>{i(m+1),M(m+1)},R=r=>{r.startsWith("http://")||r.startsWith("https://")?L(r):L(`https://polygonscan.com/tx/${r}`)};return e("div",{id:"scrollableDiv",style:{height:540,overflow:"auto"},children:e(ee,{dataLength:h.length,next:v,hasMore:h.length<b,loader:e(te,{avatar:!0,paragraph:{rows:2},active:!0}),scrollableTarget:"scrollableDiv",children:e(I,{dataSource:h,renderItem:r=>t(I.Item,{className:"list",children:[t("div",{className:"text-center",children:[e(ae,{src:r.avater,size:28}),e("p",{className:"address",children:oe(r.address)}),t("p",{className:"name",children:[r.mint_id," - ",r.user_name]})]}),t("div",{className:"",children:[t("p",{className:"pBRP",children:["Mint: ",r.number_mint_pbrp," pBRP"]}),t("p",{className:"usdt",children:["Claim: ",r.number_claim_token," USDT"]})]}),e("div",{className:"date",children:ie(r.mint_time)}),e("div",{className:"view",onClick:()=>R(r.tx),children:"View"})]},r.mint_id)})})})};const ve=()=>{const{auth:n,setAuth:a,setClaim:l,claim:u}=E(),[s,m]=o.useState(0),[i,h]=o.useState(0),[c,b]=o.useState(!1),B=v=>{b(v)},[S,k]=o.useState(!1),_=v=>{k(v==="Myself")},M=async()=>{try{let v="";c&&(v=localStorage.getItem("current_period")||"");let R="";S&&(R=n.address);const r={month:v,address:R},{code:y,message:w,data:T}=await pe(r);if(y==0){const{total_mint:x,total_claim:C}=T;m(x||0),h(C||0)}else console.log(w)}catch(v){console.error(v)}};return o.useEffect(()=>{n.address&&M()},[S,c,n.address]),t("div",{className:"box-container box1-container z-10",children:[t("div",{className:"box-title-container flex items-center",children:[e("div",{className:"box-title font-bold flex-auto",children:"Recent Activity"}),t("div",{className:"switch ml-[40px] mr-[20px] flex-auto",children:[e("span",{className:"mr-[10px]",children:"Current Period"}),e(se,{checked:c,onChange:B})]}),e(ne,{defaultValue:"Everyone",className:"select-filter text-white z-50 flex-auto",onChange:_,style:{width:125},options:[{value:"Everyone",label:"Everyone"},{value:"Myself",label:"Myself"}]})]}),t("div",{className:"total-count  flex justify-between mt-[10px]",children:[t("div",{className:"count-item",children:[e("span",{className:"count-label",children:"Total pBRP Minted:"}),e("span",{className:"count-value",children:s})]}),t("div",{className:"count-item text-right",children:[e("span",{className:"count-label",children:"Total USDT Claimed:"}),e("span",{className:"count-value",children:i})]})]}),e(be,{isMyself:S,isCurrentPeriod:c})]})},we=()=>e("div",{className:"absolute top-[-62px] left-[-109px]",children:e(j,{name:"topLeftBg",size:172})});const Te=()=>e("div",{className:"top-right-bg absolute top-[-232px] right-[-259px]",children:e(j,{name:"topRightBg",width:390,height:418})});const xe=()=>e("div",{className:"bottom-left-bg absolute bottom-[-381px] left-[-200px]"});const Ne=()=>e("div",{className:"bottom-right-bg absolute bottom-[-107px] right-[-172px]"}),Pe=()=>e("div",{className:"home font-sans tracking-wider",children:t("div",{className:"flex items-center justify-between relative",children:[e(ge,{}),e(ve,{}),e(we,{}),e(xe,{}),e(Te,{}),e(Ne,{})]})});export{Pe as default};
//# sourceMappingURL=index-cfff052b.js.map
